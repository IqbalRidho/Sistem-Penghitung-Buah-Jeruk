<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Sistem Penghitung Buah Jeruk</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        @font-face {
            font-family: 'Gotham';
            src: url("{{ url_for('static', filename='font/GothamBook.ttf') }}");
            font-weight: 400;
        }
        @font-face {
            font-family: 'Gotham';
            src: url("{{ url_for('static', filename='font/Gotham-Bold.otf') }}");
            font-weight: 700;
        }
        body {
            margin: 0;
            font-family: 'Gotham', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f2f3f7;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            z-index: 0;
        }

        /* background jeruk blur */
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: 
                linear-gradient(
                    rgba(255,255,255,0.15),
                    rgba(255,255,255,0.15)
                ),
                url("{{ url_for('static', filename='img/jerukBg.jpg') }}");
            background-size: cover;
            background-position: center;
            filter: blur(5px);
            transform: scale(1.1);
            z-index: -2;
        }

        /* ================= LANDING ================= */
        .landing {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #c8c7cc, #f2f3f7);
            overflow: hidden;
            z-index: 9999;
        }

        /* Texture overlay */
        .landing::before {
            content: "";
            position: absolute;
            inset: 0;
            background: url("{{ url_for('static', filename='img/texture.jpg') }}");
            background-size: cover;
            opacity: 0.25;
            z-index: 1;
            pointer-events: none;
        }

        /* Text section */
        .landing-text {
            flex: 1;
            padding-left: 100px;
            position: relative;
            z-index: 2;
        }

        .landing-text h1 {
            font-size: 5em;
            color: #dd6316;
            font-weight: 700;
            line-height: 1.1;
        }

        .landing-text p {
            font-size: 1.3em;
            max-width: 600px;
            font-weight: 500;
            color: #ee9411;
        }

        .start-btn {
            margin-top: 30px;
            padding: 15px 50px;
            border-radius: 999px;
            border: none;
            background: #dd6316;
            color: white; 
            font-size: 1.9rem;   
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(250, 247, 247, 0.25);
        }

        /* Image section */
        .landing-visual {
            position: absolute;
            top: 0;
            right: 0;
            width: 45%;
            height: 100%;
            overflow: hidden;
            z-index: 2;
        }

        .landing-visual img {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ================= MAIN APP ================= */
        .container-box {
            max-width: 1200px;
            margin: 40px auto;
            /*background: rgb(255, 255, 255);*/
            background:  #f2f3f7;
            overflow: hidden;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,.2);
            position: relative;
            z-index: 10;
        }
        .container-box::before {
            content: "";
            position: absolute;
            inset: 0;
            background: url("{{ url_for('static', filename='img/texture.jpg') }}");
            background-size: cover;
            opacity: 0.25;
            z-index: -1;
            pointer-events: none;
        }

        .info-card {
            background: rgba(248, 249, 255, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 4px solid #dd6316;
        }

        .info-card h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }

        .info-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-card ul li {
            padding: 6px 0;
            font-size: 0.95rem;
            color: #555;
        }

        .info-card ul li strong {
            color: #000;
        }

        /* Upload Box - Redesign sesuai gambar */
        .upload-box {
            border: 3px dashed #dd6316;
            padding: 50px 40px;
            border-radius: 15px;
            background: rgba(102, 126, 234, 0.03);
            text-align: center;
        }

        .upload-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
        }

        .upload-box h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-box p {
            color: #666;
            font-size: 1rem;
            margin-bottom: 25px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-select-btn {
            padding: 12px 40px;
            background: #dd6316;
            color: white;
            border: none;
            border-radius: 999px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-select-btn:hover {
            background: #bb4d13;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn {
            padding: 12px 50px;
            background: #d0d0d0;
            color: #888;
            border: none;
            border-radius: 999px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
        }

        .analyze-btn.active {
            background: #dd6316;
            color: white;
            cursor: pointer;
        }

        .analyze-btn.active:hover {
            background: #dd6316;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .file-name {
            margin-top: 15px;
            margin-bottom: 10px;
            color: #000;
            font-weight: 400;
            font-size: 0.95rem;
        }

        .image-grid {
            display: none;
            grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
            gap: 20px;
            font-weight: 700;
            margin-top: 30px;
        }

        .image-grid.show {
            display: grid;
        }
        .image-box h5,
        .image-box strong {
            font-size: 1.4rem;   
            font-weight: 700;
            margin: 12px 0;
            text-align: center;
        }


        .results-title {
            display: none;
            text-align: center;
            margin-top: 40px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .results-title.show {
            display: block;
        }

        .count-display {
            display: none;
            text-align: center;
            font-size: 3rem;
            font-weight: 700;
            color: #dd6316;
            margin-bottom: 20px;
        }

        .count-display.show {
            display: block;
        }

        .image-box {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,.1);
        }

        .image-box img {
            width: 100%;
            border-radius: 10px;
        }
    </style>
</head>

<body>

<!-- ================= LANDING PAGE ================= -->
<div class="landing" id="landing">
    <div class="landing-text">
        <h1>Sistem<br>Penghitung<br>Buah Jeruk</h1>
        <p>
            Aplikasi berbasis pengolahan citra untuk mendeteksi dan menghitung
            buah menggunakan metode YOLOv8 Segmentation.
        </p>
        <button class="start-btn" onclick="startApp()">Mulai</button>
    </div>

    <div class="landing-visual">
        <img src="{{ url_for('static', filename='img/jerukBg.jpg') }}" alt="Jeruk">
    </div>
</div>

<!-- ================= MAIN APP ================= -->
<div class="container-box">

    <!-- Info Card -->
    <div class="info-card">
        <h2>üìã Tahapan Pengolahan Citra</h2>
        <ul>
            <li><strong>Akuisisi Citra:</strong> Pengambilan citra buah melalui proses upload</li>
            <li><strong>Pra-pemrosesan:</strong> Resize citra</li>
            <li><strong>Segmentasi Objek:</strong> Pemisahan objek buah menggunakan YOLOv8 Segmentation</li>
            <li><strong>Penyaringan Objek:</strong> Seleksi objek berdasarkan luas area mask</li>
            <li><strong>Deteksi Tepi:</strong> Penerapan Canny Edge Detection untuk memperjelas batas objek</li>
            <li><strong>Visualisasi Hasil:</strong> Penampilan hasil segmentasi dan perhitungan jumlah buah</li>
        </ul>
    </div>

    <!-- Upload Box -->
    <div class="upload-box">
        <div class="upload-icon">üì§</div>
        <h3>Upload Gambar Buah</h3>
        <p>Format: JPG, JPEG, PNG | Maks 16MB</p>
        
        <div class="file-input-wrapper">
            <input type="file" id="fileInput" accept="image/*" onchange="fileSelected()">
            <button class="file-select-btn">Pilih Gambar</button>
        </div>
        
        <div class="file-name" id="fileName"></div>
        
        <button class="analyze-btn" id="analyzeBtn" onclick="uploadImage()">Mulai Analisis</button>
    </div>

    <h2 class="results-title" id="resultsTitle">Hasil Deteksi</h2>
    <h1 class="count-display" id="count">0</h1>

    <div class="image-grid" id="imageGrid">
        <div class="image-box"><h5>Asli</h5><img id="imgOriginal"></div>
        <div class="image-box"><h5>Masking</h5><img id="imgMask"></div>
        <div class="image-box"><h5>Edge</h5><img id="imgEdges"></div>
        <div class="image-box"><h5>Hasil</h5><img id="imgResult"></div>
    </div>
</div>

<script>
function startApp() {
    document.getElementById('landing').style.display = 'none';
}

function fileSelected() {
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    if (fileInput.files.length > 0) {
        fileName.textContent = 'üìÅ ' + fileInput.files[0].name;
        analyzeBtn.classList.add('active');
        analyzeBtn.style.cursor = 'pointer';
    } else {
        fileName.textContent = '';
        analyzeBtn.classList.remove('active');
        analyzeBtn.style.cursor = 'not-allowed';
    }
}

async function uploadImage() {
    const fileInput = document.getElementById('fileInput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    if (!fileInput.files.length) {
        alert("Pilih gambar dulu");
        return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const res = await fetch("/upload", {
        method: "POST",
        body: formData
    });

    const data = await res.json();

    if (!data.success) {
        alert(data.error);
        return;
    }

    document.getElementById("count").innerText = data.count;
    document.getElementById("resultsTitle").classList.add("show");
    document.getElementById("count").classList.add("show");
    document.getElementById("imageGrid").classList.add("show");
    
    imgOriginal.src = data.images.original;
    imgMask.src = data.images.mask;
    imgEdges.src = data.images.edges;
    imgResult.src = data.images.result;
}
</script>

</body>
</html>